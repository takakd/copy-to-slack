!function(e){var t={};function o(n){if(t[n])return t[n].exports;var s=t[n]={i:n,l:!1,exports:{}};return e[n].call(s.exports,s,s.exports,o),s.l=!0,s.exports}o.m=e,o.c=t,o.d=function(e,t,n){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)o.d(n,s,function(t){return e[t]}.bind(null,s));return n},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="",o(o.s=0)}([function(e,t,o){"use strict";o.r(t),o.d(t,"Const",(function(){return a})),o.d(t,"getOptionFromForm",(function(){return c})),o.d(t,"validateForm",(function(){return d})),o.d(t,"removeSlackHostPathFromSlackwebhookPath",(function(){return r})),o.d(t,"validateSlackwebhookPath",(function(){return l})),o.d(t,"validateButtons",(function(){return i})),o.d(t,"setButtonUiState",(function(){return u})),o.d(t,"maskwebhookPathInputValue",(function(){return h})),o.d(t,"togglewebhookPathInputMask",(function(){return m})),o.d(t,"showAlertMessage",(function(){return b})),o.d(t,"constructOptions",(function(){return k}));class n{constructor(e){this.webhookPath="","object"==typeof e&&e.webhookPath&&(this.webhookPath=e.webhookPath)}get webhookUrl(){return this.webhookPath?"https://hooks.slack.com/services/"+this.webhookPath:""}validate(){let e={};return this.webhookPath?this.webhookPath.match(/^(?!(http|\/))[a-zA-Z0-9/]+/)||(e.webhookPath="Enter a correct URL."):e.webhookPath="Enter a Slack Webhook URL for sending message.",e}}class s{constructor(e){this.chrome=e}async getOptions(){return new Promise(e=>{this.chrome.storage.sync.get(["hoge"],t=>{const o=new n(t.hoge);e(o)})})}async setOptions(e){return new Promise((t,o)=>{e instanceof n!=!1?this.chrome.storage.sync.set({hoge:e},()=>{t(!0)}):o("wrong instanceof")})}async contextMenuOnClickedCallback(e){if(!("fuga"===e.menuItemId))return;let t="";const o=["selectionText","linkUrl","srcUrl","pageUrl","frameUrl"];for(const n of o)if(e[n]){t=e[n];break}if(!t)return void console.log("no contents");const n=await this.getOptions();this.sendRequestToSlackApi(t,n.webhookUrl)}addContextMenu(){this.chrome.contextMenus.onClicked.addListener(this.contextMenuOnClickedCallback.bind(this));this.chrome.contextMenus.create({id:"fuga",type:"normal",title:"Send to Slack",contexts:["all"],visible:!0})}async sendRequestToSlackApi(e,t){const o={text:e};return await fetch(t,{method:"POST",cache:"no-cache",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:JSON.stringify(o)}).then(e=>e.text()).then(e=>e)}}const a={domId:{form:"optionForm",webhookPath:"slackWebhookPathInput",testButton:"testButton",saveButton:"saveButton",testButtonLabel:"testButtonLabel",saveButtonLabel:"saveButtonLabel",webhookFeedback:"slackWebhookPathInvalidFeedback",webhookMaskButton:"toggleWebhookPathMaskButton",webhookIconMask:"toggleWebhookPathMaskButtonMask",webhookIconUnMask:"toggleWebhookPathMaskButtonUnMask",alert:"alertMessage",alertTemplate:"alertMessageTemplate"},label:{save:"Save",saving:"Saving...",saveSuccess:"Saved.",test:"Test",testing:"Sending...",testSuccess:"Sent.",testSuccessAddition:"Check Slack channel.",testFailed:"Failed to send a test message."},uiStateChangeIntervalInSec:1};function c(){const e=document.getElementById(a.domId.webhookPath),t=new n;return t.webhookPath=e.value,t}function d(){const e=l();return i(),e}function r(){const e=document.getElementById(a.domId.webhookPath),t=e.value.replace("https://hooks.slack.com/services/","");t&&(e.value=t)}function l(){const e=c().validate(),t=document.getElementById(a.domId.webhookPath);if(e.webhookPath?t.classList.add("is-invalid"):t.classList.remove("is-invalid"),e.webhookPath){document.getElementById(a.domId.webhookFeedback).textContent=e.webhookPath}return void 0===e.webhookPath}function i(){const e=void 0===c().validate().webhookPath;u(a.domId.testButton,a.domId.testButtonLabelst,e?2:1,""),u(a.domId.saveButton,a.domId.saveButtonLabele,e?2:1,"")}function u(e,t,o,n){const s=document.getElementById(e),a=document.getElementById(t);a&&(a.textContent=n),1===o?(s.classList.remove("running"),s.disabled=!0):2===o?(s.classList.remove("running"),s.disabled=!1):3===o&&(s.classList.add("running"),s.disabled=!1)}function h(e){const t=document.getElementById(a.domId.webhookPath),o=document.getElementById(a.domId.webhookIconMask),n=document.getElementById(a.domId.webhookIconUnMask);e?(t.setAttribute("type","password"),o.classList.remove("d-none"),n.classList.add("d-none")):(t.setAttribute("type","text"),o.classList.add("d-none"),n.classList.remove("d-none"))}function m(){h(document.getElementById(a.domId.webhookIconMask).classList.contains("d-none"))}function b(e,t,o,n){if(e){const e=document.getElementById(a.domId.alertTemplate),s=e.cloneNode(!0).getElementsByClassName("alert"),c=s[0].getElementsByClassName("alertMessage"),d=s[0].getElementsByClassName("alertAdditionMessage");s[0].id=a.domId.alert,s[0].classList.add(t?"alert-danger":"alert-success"),c[0].textContent=o,n?d[0].textContent=n:d[0].remove(),e.before(s[0])}else{const e=document.getElementById(a.domId.alert);e&&e.remove()}}function k(){const e=document.getElementById(a.domId.webhookPath);e&&e.addEventListener("blur",()=>{r(),l(),i()});const t=document.getElementById(a.domId.testButton);t&&t.addEventListener("click",()=>{d()&&(b(!1),u(a.domId.testButton,a.domId.testButtonLabel,3,a.label.testing),setTimeout(async()=>{const e=new s(chrome),t=c(),o=await e.sendRequestToSlackApi("test message.",t.webhookUrl).catch(e=>e),n=o instanceof Error;n?b(!0,n,a.label.testFailed,o.stack):b(!0,n,a.label.testSuccess,a.label.testSuccessAddition),u(a.domId.testButton,a.domId.testButtonLabel,2,a.label.test)},1e3*a.uiStateChangeIntervalInSec))});const o=document.getElementById(a.domId.form);o&&o.addEventListener("submit",e=>{e.preventDefault(),e.stopPropagation();d()&&(b(!1),u(a.domId.saveButton,a.domId.saveButtonLabel,3,a.label.saving),setTimeout(()=>{const e=new s(chrome),t=c();e.setOptions(t).then(()=>{b(!0,!1,a.label.saveSuccess),u(a.domId.saveButton,a.domId.saveButtonLabel,2,a.label.save)})},1e3*a.uiStateChangeIntervalInSec))});const n=document.getElementById(a.domId.webhookMaskButton);n&&n.addEventListener("click",()=>{m()});new s(chrome).getOptions().then(e=>{0===Object.keys(e.validate()).length&&(document.getElementById(a.domId.webhookPath).value=e.webhookPath),i(),h(!0)})}k()}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vd2VicGFjay9ib290c3RyYXAiLCJ3ZWJwYWNrOi8vLy4vc3JjL2N1cnNvcmVkdG9zbGFjay1vcHRpb24uanMiLCJ3ZWJwYWNrOi8vLy4vc3JjL2N1cnNvcmVkdG9zbGFjay5qcyIsIndlYnBhY2s6Ly8vLi9zcmMvb3B0aW9ucy5qcyJdLCJuYW1lcyI6WyJpbnN0YWxsZWRNb2R1bGVzIiwiX193ZWJwYWNrX3JlcXVpcmVfXyIsIm1vZHVsZUlkIiwiZXhwb3J0cyIsIm1vZHVsZSIsImkiLCJsIiwibW9kdWxlcyIsImNhbGwiLCJtIiwiYyIsImQiLCJuYW1lIiwiZ2V0dGVyIiwibyIsIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwiZW51bWVyYWJsZSIsImdldCIsInIiLCJTeW1ib2wiLCJ0b1N0cmluZ1RhZyIsInZhbHVlIiwidCIsIm1vZGUiLCJfX2VzTW9kdWxlIiwibnMiLCJjcmVhdGUiLCJrZXkiLCJiaW5kIiwibiIsIm9iamVjdCIsInByb3BlcnR5IiwicHJvdG90eXBlIiwiaGFzT3duUHJvcGVydHkiLCJwIiwicyIsIkN1cnNvcmVkVG9TbGFja09wdGlvbiIsImNvbnN0cnVjdG9yIiwidmFsdWVzIiwidGhpcyIsIndlYmhvb2tQYXRoIiwidmFsaWRhdGUiLCJlcnJvcnMiLCJtYXRjaCIsIkN1cnNvcmVkVG9TbGFjayIsImNocm9tZSIsIlByb21pc2UiLCJyZXNvbHZlIiwic3RvcmFnZSIsInN5bmMiLCJyZXN1bHQiLCJyZWplY3QiLCJzZXQiLCJpbmZvIiwibWVudUl0ZW1JZCIsIm1lc3NhZ2UiLCJvcmRlckxpc3QiLCJvcmRlciIsImNvbnNvbGUiLCJsb2ciLCJvcHRpb25zIiwiZ2V0T3B0aW9ucyIsInNlbmRSZXF1ZXN0VG9TbGFja0FwaSIsIndlYmhvb2tVcmwiLCJhZGRDb250ZXh0TWVudSIsImNvbnRleHRNZW51cyIsIm9uQ2xpY2tlZCIsImFkZExpc3RlbmVyIiwiY29udGV4dE1lbnVPbkNsaWNrZWRDYWxsYmFjayIsImlkIiwidHlwZSIsInRpdGxlIiwiY29udGV4dHMiLCJ2aXNpYmxlIiwidGV4dCIsImJvZHkiLCJmZXRjaCIsIm1ldGhvZCIsImNhY2hlIiwiaGVhZGVycyIsIkpTT04iLCJzdHJpbmdpZnkiLCJ0aGVuIiwicmVzIiwiQ29uc3QiLCJkb21JZCIsImZvcm0iLCJ0ZXN0QnV0dG9uIiwic2F2ZUJ1dHRvbiIsInRlc3RCdXR0b25MYWJlbCIsInNhdmVCdXR0b25MYWJlbCIsIndlYmhvb2tGZWVkYmFjayIsIndlYmhvb2tNYXNrQnV0dG9uIiwid2ViaG9va0ljb25NYXNrIiwid2ViaG9va0ljb25Vbk1hc2siLCJhbGVydCIsImFsZXJ0VGVtcGxhdGUiLCJsYWJlbCIsInNhdmUiLCJzYXZpbmciLCJzYXZlU3VjY2VzcyIsInRlc3QiLCJ0ZXN0aW5nIiwidGVzdFN1Y2Nlc3MiLCJ0ZXN0U3VjY2Vzc0FkZGl0aW9uIiwidGVzdEZhaWxlZCIsInVpU3RhdGVDaGFuZ2VJbnRlcnZhbEluU2VjIiwiZ2V0T3B0aW9uRnJvbUZvcm0iLCJ3ZWJob29rUGF0aElucHV0IiwiZG9jdW1lbnQiLCJnZXRFbGVtZW50QnlJZCIsIm9wdGlvbiIsInZhbGlkYXRlRm9ybSIsInZhbGlkVXJsIiwidmFsaWRhdGVTbGFja3dlYmhvb2tQYXRoIiwidmFsaWRhdGVCdXR0b25zIiwicmVtb3ZlU2xhY2tIb3N0UGF0aEZyb21TbGFja3dlYmhvb2tQYXRoIiwiaW5wdXQiLCJyZXBsYWNlZCIsInJlcGxhY2UiLCJjbGFzc0xpc3QiLCJhZGQiLCJyZW1vdmUiLCJ0ZXh0Q29udGVudCIsImlzVmFsaWQiLCJzZXRCdXR0b25VaVN0YXRlIiwidGVzdEJ1dHRvbkxhYmVsc3QiLCJzYXZlQnV0dG9uTGFiZWxlIiwiYnV0dG9uSWQiLCJsYWJlbElkIiwic3RhdGUiLCJidXR0b24iLCJidXR0b25MYWJlbCIsImRpc2FibGVkIiwibWFza3dlYmhvb2tQYXRoSW5wdXRWYWx1ZSIsImlzTWFzayIsImljb25NYXNrIiwiaWNvblVuTWFzayIsInNldEF0dHJpYnV0ZSIsInRvZ2dsZXdlYmhvb2tQYXRoSW5wdXRNYXNrIiwiY29udGFpbnMiLCJzaG93QWxlcnRNZXNzYWdlIiwiaXNTaG93IiwiaXNFcnJvciIsImFkZGl0aW9uTWVzc2FnZSIsInRlbXBsYXRlIiwiY2xvbmVOb2RlIiwiZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSIsImFsZXJ0TWVzc2FnZSIsImFsZXJ0QWRkaXRpb25NZXNzYWdlIiwiYmVmb3JlIiwiY29uc3RydWN0T3B0aW9ucyIsIndlYmhvb2tJbnB1dCIsImFkZEV2ZW50TGlzdGVuZXIiLCJzZXRUaW1lb3V0IiwiYXN5bmMiLCJjdHMiLCJjYXRjaCIsImVycm9yIiwiRXJyb3IiLCJzdGFjayIsImV2ZW50IiwicHJldmVudERlZmF1bHQiLCJzdG9wUHJvcGFnYXRpb24iLCJzZXRPcHRpb25zIiwibWFza0J1dHRvbiIsImtleXMiLCJsZW5ndGgiXSwibWFwcGluZ3MiOiJhQUNFLElBQUlBLEVBQW1CLEdBR3ZCLFNBQVNDLEVBQW9CQyxHQUc1QixHQUFHRixFQUFpQkUsR0FDbkIsT0FBT0YsRUFBaUJFLEdBQVVDLFFBR25DLElBQUlDLEVBQVNKLEVBQWlCRSxHQUFZLENBQ3pDRyxFQUFHSCxFQUNISSxHQUFHLEVBQ0hILFFBQVMsSUFVVixPQU5BSSxFQUFRTCxHQUFVTSxLQUFLSixFQUFPRCxRQUFTQyxFQUFRQSxFQUFPRCxRQUFTRixHQUcvREcsRUFBT0UsR0FBSSxFQUdKRixFQUFPRCxRQUtmRixFQUFvQlEsRUFBSUYsRUFHeEJOLEVBQW9CUyxFQUFJVixFQUd4QkMsRUFBb0JVLEVBQUksU0FBU1IsRUFBU1MsRUFBTUMsR0FDM0NaLEVBQW9CYSxFQUFFWCxFQUFTUyxJQUNsQ0csT0FBT0MsZUFBZWIsRUFBU1MsRUFBTSxDQUFFSyxZQUFZLEVBQU1DLElBQUtMLEtBS2hFWixFQUFvQmtCLEVBQUksU0FBU2hCLEdBQ1gsb0JBQVhpQixRQUEwQkEsT0FBT0MsYUFDMUNOLE9BQU9DLGVBQWViLEVBQVNpQixPQUFPQyxZQUFhLENBQUVDLE1BQU8sV0FFN0RQLE9BQU9DLGVBQWViLEVBQVMsYUFBYyxDQUFFbUIsT0FBTyxLQVF2RHJCLEVBQW9Cc0IsRUFBSSxTQUFTRCxFQUFPRSxHQUV2QyxHQURVLEVBQVBBLElBQVVGLEVBQVFyQixFQUFvQnFCLElBQy9CLEVBQVBFLEVBQVUsT0FBT0YsRUFDcEIsR0FBVyxFQUFQRSxHQUE4QixpQkFBVkYsR0FBc0JBLEdBQVNBLEVBQU1HLFdBQVksT0FBT0gsRUFDaEYsSUFBSUksRUFBS1gsT0FBT1ksT0FBTyxNQUd2QixHQUZBMUIsRUFBb0JrQixFQUFFTyxHQUN0QlgsT0FBT0MsZUFBZVUsRUFBSSxVQUFXLENBQUVULFlBQVksRUFBTUssTUFBT0EsSUFDdEQsRUFBUEUsR0FBNEIsaUJBQVRGLEVBQW1CLElBQUksSUFBSU0sS0FBT04sRUFBT3JCLEVBQW9CVSxFQUFFZSxFQUFJRSxFQUFLLFNBQVNBLEdBQU8sT0FBT04sRUFBTU0sSUFBUUMsS0FBSyxLQUFNRCxJQUM5SSxPQUFPRixHQUlSekIsRUFBb0I2QixFQUFJLFNBQVMxQixHQUNoQyxJQUFJUyxFQUFTVCxHQUFVQSxFQUFPcUIsV0FDN0IsV0FBd0IsT0FBT3JCLEVBQWdCLFNBQy9DLFdBQThCLE9BQU9BLEdBRXRDLE9BREFILEVBQW9CVSxFQUFFRSxFQUFRLElBQUtBLEdBQzVCQSxHQUlSWixFQUFvQmEsRUFBSSxTQUFTaUIsRUFBUUMsR0FBWSxPQUFPakIsT0FBT2tCLFVBQVVDLGVBQWUxQixLQUFLdUIsRUFBUUMsSUFHekcvQixFQUFvQmtDLEVBQUksR0FJakJsQyxFQUFvQkEsRUFBb0JtQyxFQUFJLEcsb21CQzVFOUMsTUFBTUMsRUFLWEMsWUFBWUMsR0FDVkMsS0FBS0MsWUFBYyxHQUVHLGlCQUFYRixHQUNMQSxFQUFNLGNBQ1JDLEtBQUtDLFlBQWNGLEVBQU0sYUFTL0IsaUJBQ0UsT0FBS0MsS0FBS0MsWUF4QjRCLG9DQTJCRkQsS0FBS0MsWUFGaEMsR0FXWEMsV0FDRSxJQUFJQyxFQUFTLEdBUWIsT0FOS0gsS0FBS0MsWUFFRUQsS0FBS0MsWUFBWUcsTUFBTSxpQ0FDakNELEVBQU0sWUFBa0Isd0JBRnhCQSxFQUFNLFlBQWtCLGlEQUtuQkEsR0M3QkksTUFBTUUsRUFNbkJQLFlBQVlRLEdBQ1ZOLEtBQUtNLE9BQVNBLEVBT2hCLG1CQUNFLE9BQU8sSUFBSUMsUUFBU0MsSUFDbEJSLEtBQUtNLE9BQU9HLFFBQVFDLEtBQUtoQyxJQUFJLENBMUJoQixRQTBCK0JpQyxJQUMxQyxNQUFNN0IsRUFBUSxJQUFJZSxFQUFzQmMsRUFBTSxNQUM5Q0gsRUFBUTFCLE9BVWQsaUJBQWlCQSxHQUNmLE9BQU8sSUFBSXlCLFFBQVEsQ0FBQ0MsRUFBU0ksS0FDdkI5QixhQUFpQmUsSUFBMEIsRUFJL0NHLEtBQUtNLE9BQU9HLFFBQVFDLEtBQUtHLElBQUksQ0FBRSxLQUFjL0IsR0FBUyxLQUNwRDBCLEdBQVEsS0FKUkksRUFBTyxzQkFlYixtQ0FBbUNFLEdBRWpDLEtBcERrQixTQW1Ea0JBLEVBQUtDLFlBRXZDLE9BR0YsSUFBSUMsRUFBVSxHQUNkLE1BQU1DLEVBQVksQ0FDaEIsZ0JBQ0EsVUFDQSxTQUNBLFVBQ0EsWUFFRixJQUFLLE1BQU1DLEtBQVNELEVBQ2xCLEdBQUlILEVBQUtJLEdBQVEsQ0FDZkYsRUFBVUYsRUFBS0ksR0FDZixNQUdKLElBQUtGLEVBRUgsWUFEQUcsUUFBUUMsSUFBSSxlQUlkLE1BQU1DLFFBQWdCckIsS0FBS3NCLGFBQzNCdEIsS0FBS3VCLHNCQUFzQlAsRUFBU0ssRUFBUUcsWUFNOUNDLGlCQUVFekIsS0FBS00sT0FBT29CLGFBQWFDLFVBQVVDLFlBQ2pDNUIsS0FBSzZCLDZCQUE2QnhDLEtBQUtXLE9BS3pDQSxLQUFLTSxPQUFPb0IsYUFBYXZDLE9BQU8sQ0FDOUIyQyxHQTNGZ0IsT0E0RmhCQyxLQUFNLFNBQ05DLE1BQU8sZ0JBQ1BDLFNBTGUsQ0FBQyxPQU1oQkMsU0FBUyxJQVNiLDRCQUE0QkMsRUFBTVgsR0FFaEMsTUFBTVksRUFBTyxDQUFFRCxLQUFNQSxHQUVyQixhQUFhRSxNQUFNYixFQUFZLENBQzdCYyxPQUFRLE9BQ1JDLE1BQU8sV0FDUEMsUUFBUyxDQUdQLGVBQWdCLHFDQUVsQkosS0FBTUssS0FBS0MsVUFBVU4sS0FFcEJPLEtBQU1DLEdBQVFBLEVBQUlULFFBQ2xCUSxLQUFNUCxHQUFTQSxJQy9IZixNQUFNUyxFQUFRLENBQ25CQyxNQUFPLENBQ0xDLEtBQU0sYUFDTjlDLFlBQWEsd0JBQ2IrQyxXQUFZLGFBQ1pDLFdBQVksYUFDWkMsZ0JBQWlCLGtCQUNqQkMsZ0JBQWlCLGtCQUNqQkMsZ0JBQWlCLGtDQUNqQkMsa0JBQW1CLDhCQUNuQkMsZ0JBQWlCLGtDQUNqQkMsa0JBQW1CLG9DQUNuQkMsTUFBTyxlQUNQQyxjQUFlLHdCQUVqQkMsTUFBTyxDQUNMQyxLQUFNLE9BQ05DLE9BQVEsWUFDUkMsWUFBYSxTQUNiQyxLQUFNLE9BQ05DLFFBQVMsYUFDVEMsWUFBYSxRQUNiQyxvQkFBcUIsdUJBQ3JCQyxXQUFZLGtDQUVkQywyQkFBNEIsR0FPdkIsU0FBU0MsSUFDZCxNQUFNQyxFQUFtQkMsU0FBU0MsZUFBZTFCLEVBQU1DLE1BQU03QyxhQUV2RHVFLEVBQVMsSUFBSTNFLEVBR25CLE9BRkEyRSxFQUFPdkUsWUFBY29FLEVBQWlCdkYsTUFFL0IwRixFQU9GLFNBQVNDLElBQ2QsTUFBTUMsRUFBV0MsSUFFakIsT0FEQUMsSUFDT0YsRUFRRixTQUFTRyxJQUNkLE1BQU1DLEVBQVFSLFNBQVNDLGVBQWUxQixFQUFNQyxNQUFNN0MsYUFDNUM4RSxFQUFXRCxFQUFNaEcsTUFBTWtHLFFGOURXLG9DRThEeUIsSUFDN0RELElBQ0ZELEVBQU1oRyxNQUFRaUcsR0FRWCxTQUFTSixJQUNkLE1BQ014RSxFQURTaUUsSUFDT2xFLFdBQ2hCNEUsRUFBUVIsU0FBU0MsZUFBZTFCLEVBQU1DLE1BQU03QyxhQU9sRCxHQU5JRSxFQUFNLFlBQ1IyRSxFQUFNRyxVQUFVQyxJQUFJLGNBRXBCSixFQUFNRyxVQUFVRSxPQUFPLGNBR3JCaEYsRUFBTSxZQUFpQixDQUNSbUUsU0FBU0MsZUFBZTFCLEVBQU1DLE1BQU1NLGlCQUM1Q2dDLFlBQWNqRixFQUFNLFlBRy9CLFlBQXdDLElBQTFCQSxFQUFNLFlBTWYsU0FBU3lFLElBQ2QsTUFFTVMsT0FBMkMsSUFGbENqQixJQUNPbEUsV0FDTyxZQUU3Qm9GLEVBQ0V6QyxFQUFNQyxNQUFNRSxXQUNaSCxFQUFNQyxNQUFNeUMsa0JBQ1pGLEVBQVUsRUFBSSxFQUNkLElBRUZDLEVBQ0V6QyxFQUFNQyxNQUFNRyxXQUNaSixFQUFNQyxNQUFNMEMsaUJBQ1pILEVBQVUsRUFBSSxFQUNkLElBV0csU0FBU0MsRUFBaUJHLEVBQVVDLEVBQVNDLEVBQU9qQyxHQUN6RCxNQUFNa0MsRUFBU3RCLFNBQVNDLGVBQWVrQixHQUNqQ0ksRUFBY3ZCLFNBQVNDLGVBQWVtQixHQUN4Q0csSUFDRkEsRUFBWVQsWUFBYzFCLEdBRWQsSUFBVmlDLEdBQ0ZDLEVBQU9YLFVBQVVFLE9BQU8sV0FDeEJTLEVBQU9FLFVBQVcsR0FDQyxJQUFWSCxHQUNUQyxFQUFPWCxVQUFVRSxPQUFPLFdBQ3hCUyxFQUFPRSxVQUFXLEdBQ0MsSUFBVkgsSUFDVEMsRUFBT1gsVUFBVUMsSUFBSSxXQUNyQlUsRUFBT0UsVUFBVyxHQVFmLFNBQVNDLEVBQTBCQyxHQUN4QyxNQUFNbEIsRUFBUVIsU0FBU0MsZUFBZTFCLEVBQU1DLE1BQU03QyxhQUM1Q2dHLEVBQVczQixTQUFTQyxlQUFlMUIsRUFBTUMsTUFBTVEsaUJBQy9DNEMsRUFBYTVCLFNBQVNDLGVBQWUxQixFQUFNQyxNQUFNUyxtQkFDbkR5QyxHQUNGbEIsRUFBTXFCLGFBQWEsT0FBUSxZQUMzQkYsRUFBU2hCLFVBQVVFLE9BQU8sVUFDMUJlLEVBQVdqQixVQUFVQyxJQUFJLFlBRXpCSixFQUFNcUIsYUFBYSxPQUFRLFFBQzNCRixFQUFTaEIsVUFBVUMsSUFBSSxVQUN2QmdCLEVBQVdqQixVQUFVRSxPQUFPLFdBT3pCLFNBQVNpQixJQUdkTCxFQUZpQnpCLFNBQVNDLGVBQWUxQixFQUFNQyxNQUFNUSxpQkFDekIyQixVQUFVb0IsU0FBUyxXQVcxQyxTQUFTQyxFQUFpQkMsRUFBUUMsRUFBU3hGLEVBQVN5RixHQUN6RCxHQUFJRixFQUFRLENBQ1YsTUFBTUcsRUFBV3BDLFNBQVNDLGVBQWUxQixFQUFNQyxNQUFNVyxlQUUvQ0QsRUFEYWtELEVBQVNDLFdBQVUsR0FDYkMsdUJBQXVCLFNBQzFDQyxFQUFlckQsRUFBTSxHQUFHb0QsdUJBQXVCLGdCQUMvQ0UsRUFBdUJ0RCxFQUFNLEdBQUdvRCx1QkFDcEMsd0JBRUZwRCxFQUFNLEdBQUcxQixHQUFLZSxFQUFNQyxNQUFNVSxNQUMxQkEsRUFBTSxHQUFHeUIsVUFBVUMsSUFBSXNCLEVBQVUsZUFBaUIsaUJBQ2xESyxFQUFhLEdBQUd6QixZQUFjcEUsRUFDMUJ5RixFQUNGSyxFQUFxQixHQUFHMUIsWUFBY3FCLEVBRXRDSyxFQUFxQixHQUFHM0IsU0FFMUJ1QixFQUFTSyxPQUFPdkQsRUFBTSxRQUNqQixDQUNMLE1BQU1BLEVBQVFjLFNBQVNDLGVBQWUxQixFQUFNQyxNQUFNVSxPQUM5Q0EsR0FDRkEsRUFBTTJCLFVBUUwsU0FBUzZCLElBQ2QsTUFBTUMsRUFBZTNDLFNBQVNDLGVBQWUxQixFQUFNQyxNQUFNN0MsYUFDckRnSCxHQUNGQSxFQUFhQyxpQkFBaUIsT0FBUSxLQUNwQ3JDLElBQ0FGLElBQ0FDLE1BSUosTUFBTTVCLEVBQWFzQixTQUFTQyxlQUFlMUIsRUFBTUMsTUFBTUUsWUFDbkRBLEdBQ0ZBLEVBQVdrRSxpQkFBaUIsUUFBUyxLQUNuQnpDLE1BS2hCNkIsR0FBaUIsR0FFakJoQixFQUNFekMsRUFBTUMsTUFBTUUsV0FDWkgsRUFBTUMsTUFBTUksZ0JBQ1osRUFDQUwsRUFBTWEsTUFBTUssU0FFZG9ELFdBQVdDLFVBQ1QsTUFBTUMsRUFBTSxJQUFJaEgsRUFBZ0JDLFFBQzFCa0UsRUFBU0osSUFDVHpELFFBQWUwRyxFQUNsQjlGLHNCQUFzQixnQkFBaUJpRCxFQUFPaEQsWUFDOUM4RixNQUFPQyxHQUFVQSxHQUVkZixFQUFVN0YsYUFBa0I2RyxNQUM5QmhCLEVBQ0ZGLEdBQWlCLEVBQU1FLEVBQVMzRCxFQUFNYSxNQUFNUSxXQUFZdkQsRUFBTzhHLE9BRS9EbkIsR0FDRSxFQUNBRSxFQUNBM0QsRUFBTWEsTUFBTU0sWUFDWm5CLEVBQU1hLE1BQU1PLHFCQUloQnFCLEVBQ0V6QyxFQUFNQyxNQUFNRSxXQUNaSCxFQUFNQyxNQUFNSSxnQkFDWixFQUNBTCxFQUFNYSxNQUFNSSxPQUVzQixJQUFuQ2pCLEVBQU1zQiwrQkFJYixNQUFNcEIsRUFBT3VCLFNBQVNDLGVBQWUxQixFQUFNQyxNQUFNQyxNQUM3Q0EsR0FDRkEsRUFBS21FLGlCQUFpQixTQUFXUSxJQUMvQkEsRUFBTUMsaUJBQ05ELEVBQU1FLGtCQUVVbkQsTUFLaEI2QixHQUFpQixHQUVqQmhCLEVBQ0V6QyxFQUFNQyxNQUFNRyxXQUNaSixFQUFNQyxNQUFNSyxnQkFDWixFQUNBTixFQUFNYSxNQUFNRSxRQUVkdUQsV0FBVyxLQUNULE1BQU1FLEVBQU0sSUFBSWhILEVBQWdCQyxRQUMxQmtFLEVBQVNKLElBQ2ZpRCxFQUFJUSxXQUFXckQsR0FBUTdCLEtBQUssS0FDMUIyRCxHQUFpQixHQUFNLEVBQU96RCxFQUFNYSxNQUFNRyxhQUUxQ3lCLEVBQ0V6QyxFQUFNQyxNQUFNRyxXQUNaSixFQUFNQyxNQUFNSyxnQkFDWixFQUNBTixFQUFNYSxNQUFNQyxTQUdvQixJQUFuQ2QsRUFBTXNCLCtCQUliLE1BQU0yRCxFQUFheEQsU0FBU0MsZUFBZTFCLEVBQU1DLE1BQU1PLG1CQUNuRHlFLEdBQ0ZBLEVBQVdaLGlCQUFpQixRQUFTLEtBQ25DZCxNQUtRLElBQUkvRixFQUFnQkMsUUFDNUJnQixhQUFhcUIsS0FBTXRCLElBQ3NDLElBQTNDOUMsT0FBT3dKLEtBQUsxRyxFQUFRbkIsWUFBWThILFNBRTlDMUQsU0FBU0MsZUFBZTFCLEVBQU1DLE1BQU03QyxhQUFhbkIsTUFDL0N1QyxFQUFRcEIsYUFFWjJFLElBRUFtQixHQUEwQixLQU81QmlCIiwiZmlsZSI6Im9wdGlvbnMuanMiLCJzb3VyY2VzQ29udGVudCI6WyIgXHQvLyBUaGUgbW9kdWxlIGNhY2hlXG4gXHR2YXIgaW5zdGFsbGVkTW9kdWxlcyA9IHt9O1xuXG4gXHQvLyBUaGUgcmVxdWlyZSBmdW5jdGlvblxuIFx0ZnVuY3Rpb24gX193ZWJwYWNrX3JlcXVpcmVfXyhtb2R1bGVJZCkge1xuXG4gXHRcdC8vIENoZWNrIGlmIG1vZHVsZSBpcyBpbiBjYWNoZVxuIFx0XHRpZihpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXSkge1xuIFx0XHRcdHJldHVybiBpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXS5leHBvcnRzO1xuIFx0XHR9XG4gXHRcdC8vIENyZWF0ZSBhIG5ldyBtb2R1bGUgKGFuZCBwdXQgaXQgaW50byB0aGUgY2FjaGUpXG4gXHRcdHZhciBtb2R1bGUgPSBpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXSA9IHtcbiBcdFx0XHRpOiBtb2R1bGVJZCxcbiBcdFx0XHRsOiBmYWxzZSxcbiBcdFx0XHRleHBvcnRzOiB7fVxuIFx0XHR9O1xuXG4gXHRcdC8vIEV4ZWN1dGUgdGhlIG1vZHVsZSBmdW5jdGlvblxuIFx0XHRtb2R1bGVzW21vZHVsZUlkXS5jYWxsKG1vZHVsZS5leHBvcnRzLCBtb2R1bGUsIG1vZHVsZS5leHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKTtcblxuIFx0XHQvLyBGbGFnIHRoZSBtb2R1bGUgYXMgbG9hZGVkXG4gXHRcdG1vZHVsZS5sID0gdHJ1ZTtcblxuIFx0XHQvLyBSZXR1cm4gdGhlIGV4cG9ydHMgb2YgdGhlIG1vZHVsZVxuIFx0XHRyZXR1cm4gbW9kdWxlLmV4cG9ydHM7XG4gXHR9XG5cblxuIFx0Ly8gZXhwb3NlIHRoZSBtb2R1bGVzIG9iamVjdCAoX193ZWJwYWNrX21vZHVsZXNfXylcbiBcdF9fd2VicGFja19yZXF1aXJlX18ubSA9IG1vZHVsZXM7XG5cbiBcdC8vIGV4cG9zZSB0aGUgbW9kdWxlIGNhY2hlXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLmMgPSBpbnN0YWxsZWRNb2R1bGVzO1xuXG4gXHQvLyBkZWZpbmUgZ2V0dGVyIGZ1bmN0aW9uIGZvciBoYXJtb255IGV4cG9ydHNcbiBcdF9fd2VicGFja19yZXF1aXJlX18uZCA9IGZ1bmN0aW9uKGV4cG9ydHMsIG5hbWUsIGdldHRlcikge1xuIFx0XHRpZighX193ZWJwYWNrX3JlcXVpcmVfXy5vKGV4cG9ydHMsIG5hbWUpKSB7XG4gXHRcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIG5hbWUsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBnZXR0ZXIgfSk7XG4gXHRcdH1cbiBcdH07XG5cbiBcdC8vIGRlZmluZSBfX2VzTW9kdWxlIG9uIGV4cG9ydHNcbiBcdF9fd2VicGFja19yZXF1aXJlX18uciA9IGZ1bmN0aW9uKGV4cG9ydHMpIHtcbiBcdFx0aWYodHlwZW9mIFN5bWJvbCAhPT0gJ3VuZGVmaW5lZCcgJiYgU3ltYm9sLnRvU3RyaW5nVGFnKSB7XG4gXHRcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFN5bWJvbC50b1N0cmluZ1RhZywgeyB2YWx1ZTogJ01vZHVsZScgfSk7XG4gXHRcdH1cbiBcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICdfX2VzTW9kdWxlJywgeyB2YWx1ZTogdHJ1ZSB9KTtcbiBcdH07XG5cbiBcdC8vIGNyZWF0ZSBhIGZha2UgbmFtZXNwYWNlIG9iamVjdFxuIFx0Ly8gbW9kZSAmIDE6IHZhbHVlIGlzIGEgbW9kdWxlIGlkLCByZXF1aXJlIGl0XG4gXHQvLyBtb2RlICYgMjogbWVyZ2UgYWxsIHByb3BlcnRpZXMgb2YgdmFsdWUgaW50byB0aGUgbnNcbiBcdC8vIG1vZGUgJiA0OiByZXR1cm4gdmFsdWUgd2hlbiBhbHJlYWR5IG5zIG9iamVjdFxuIFx0Ly8gbW9kZSAmIDh8MTogYmVoYXZlIGxpa2UgcmVxdWlyZVxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy50ID0gZnVuY3Rpb24odmFsdWUsIG1vZGUpIHtcbiBcdFx0aWYobW9kZSAmIDEpIHZhbHVlID0gX193ZWJwYWNrX3JlcXVpcmVfXyh2YWx1ZSk7XG4gXHRcdGlmKG1vZGUgJiA4KSByZXR1cm4gdmFsdWU7XG4gXHRcdGlmKChtb2RlICYgNCkgJiYgdHlwZW9mIHZhbHVlID09PSAnb2JqZWN0JyAmJiB2YWx1ZSAmJiB2YWx1ZS5fX2VzTW9kdWxlKSByZXR1cm4gdmFsdWU7XG4gXHRcdHZhciBucyA9IE9iamVjdC5jcmVhdGUobnVsbCk7XG4gXHRcdF9fd2VicGFja19yZXF1aXJlX18ucihucyk7XG4gXHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShucywgJ2RlZmF1bHQnLCB7IGVudW1lcmFibGU6IHRydWUsIHZhbHVlOiB2YWx1ZSB9KTtcbiBcdFx0aWYobW9kZSAmIDIgJiYgdHlwZW9mIHZhbHVlICE9ICdzdHJpbmcnKSBmb3IodmFyIGtleSBpbiB2YWx1ZSkgX193ZWJwYWNrX3JlcXVpcmVfXy5kKG5zLCBrZXksIGZ1bmN0aW9uKGtleSkgeyByZXR1cm4gdmFsdWVba2V5XTsgfS5iaW5kKG51bGwsIGtleSkpO1xuIFx0XHRyZXR1cm4gbnM7XG4gXHR9O1xuXG4gXHQvLyBnZXREZWZhdWx0RXhwb3J0IGZ1bmN0aW9uIGZvciBjb21wYXRpYmlsaXR5IHdpdGggbm9uLWhhcm1vbnkgbW9kdWxlc1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5uID0gZnVuY3Rpb24obW9kdWxlKSB7XG4gXHRcdHZhciBnZXR0ZXIgPSBtb2R1bGUgJiYgbW9kdWxlLl9fZXNNb2R1bGUgP1xuIFx0XHRcdGZ1bmN0aW9uIGdldERlZmF1bHQoKSB7IHJldHVybiBtb2R1bGVbJ2RlZmF1bHQnXTsgfSA6XG4gXHRcdFx0ZnVuY3Rpb24gZ2V0TW9kdWxlRXhwb3J0cygpIHsgcmV0dXJuIG1vZHVsZTsgfTtcbiBcdFx0X193ZWJwYWNrX3JlcXVpcmVfXy5kKGdldHRlciwgJ2EnLCBnZXR0ZXIpO1xuIFx0XHRyZXR1cm4gZ2V0dGVyO1xuIFx0fTtcblxuIFx0Ly8gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm8gPSBmdW5jdGlvbihvYmplY3QsIHByb3BlcnR5KSB7IHJldHVybiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwob2JqZWN0LCBwcm9wZXJ0eSk7IH07XG5cbiBcdC8vIF9fd2VicGFja19wdWJsaWNfcGF0aF9fXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLnAgPSBcIlwiO1xuXG5cbiBcdC8vIExvYWQgZW50cnkgbW9kdWxlIGFuZCByZXR1cm4gZXhwb3J0c1xuIFx0cmV0dXJuIF9fd2VicGFja19yZXF1aXJlX18oX193ZWJwYWNrX3JlcXVpcmVfXy5zID0gMCk7XG4iLCJcInVzZSBzdHJpY3RcIjtcblxuZXhwb3J0IGNvbnN0IFNsYWNrV2ViaG9va0NvbW1vbkhvc3RQYXRoID0gXCJodHRwczovL2hvb2tzLnNsYWNrLmNvbS9zZXJ2aWNlcy9cIjtcblxuLyoqXG4gKi9cbmV4cG9ydCBjbGFzcyBDdXJzb3JlZFRvU2xhY2tPcHRpb24ge1xuICAvKipcbiAgICogUmVwcmVzZW50cyBhIG9wdGlvbnMgaW4gZXh0ZW5zaW9uLlxuICAgKiBAY29uc3RydWN0b3JcbiAgICovXG4gIGNvbnN0cnVjdG9yKHZhbHVlcykge1xuICAgIHRoaXMud2ViaG9va1BhdGggPSBcIlwiO1xuXG4gICAgaWYgKHR5cGVvZiB2YWx1ZXMgPT09IFwib2JqZWN0XCIpIHtcbiAgICAgIGlmICh2YWx1ZXNbXCJ3ZWJob29rUGF0aFwiXSkge1xuICAgICAgICB0aGlzLndlYmhvb2tQYXRoID0gdmFsdWVzW1wid2ViaG9va1BhdGhcIl07XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFNsYWNrIFdlYmhvb2sgVVJMLlxuICAgKiBAcmV0dXJucyB7c3RyaW5nfSBTbGFjayBXZWJob29rIFVSTC5cbiAgICovXG4gIGdldCB3ZWJob29rVXJsKCkge1xuICAgIGlmICghdGhpcy53ZWJob29rUGF0aCkge1xuICAgICAgcmV0dXJuIFwiXCI7XG4gICAgfVxuICAgIHJldHVybiBTbGFja1dlYmhvb2tDb21tb25Ib3N0UGF0aCArIHRoaXMud2ViaG9va1BhdGg7XG4gIH1cblxuICAvKipcbiAgICogVmFsaWRhdGUgb3B0aW9uLlxuICAgKlxuICAgKiBAcmV0dXJucyB7b2JqZWN0fSBSZXR1cm5zIGVycm9yIG1lc3NhZ2UgaWYgbm90IHZhbGlkLCBlbXB0eSBvdGhlcndpc2UuXG4gICAqICBFYWNoIG1lc3NhZ2UgaXMgYXNzb2NpYXRlZCB3aXRoIGtleS5cbiAgICovXG4gIHZhbGlkYXRlKCkge1xuICAgIGxldCBlcnJvcnMgPSB7fTtcblxuICAgIGlmICghdGhpcy53ZWJob29rUGF0aCkge1xuICAgICAgZXJyb3JzW1wid2ViaG9va1BhdGhcIl0gPSBcIkVudGVyIGEgU2xhY2sgV2ViaG9vayBVUkwgZm9yIHNlbmRpbmcgbWVzc2FnZS5cIjtcbiAgICB9IGVsc2UgaWYgKCF0aGlzLndlYmhvb2tQYXRoLm1hdGNoKC9eKD8hKGh0dHB8XFwvKSlbYS16QS1aMC05L10rLykpIHtcbiAgICAgIGVycm9yc1tcIndlYmhvb2tQYXRoXCJdID0gXCJFbnRlciBhIGNvcnJlY3QgVVJMLlwiO1xuICAgIH1cblxuICAgIHJldHVybiBlcnJvcnM7XG4gIH1cbn1cbiIsIlwidXNlIHN0cmljdFwiO1xuXG5pbXBvcnQgeyBDdXJzb3JlZFRvU2xhY2tPcHRpb24gfSBmcm9tIFwiLi9jdXJzb3JlZHRvc2xhY2stb3B0aW9uXCI7XG5cbi8qKlxuICogUGVyc2lzdGVuY2Ugb3B0aW9ucyBrZXkuXG4gKiBAdHlwZSB7c3RyaW5nfVxuICovXG5jb25zdCBPcHRpb25zS2V5ID0gXCJob2dlXCI7XG5cbi8qKlxuICogQ29udGV4dE1lbnVJZFxuICogQHR5cGUge3N0cmluZ31cbiAqL1xuY29uc3QgQ29udGV4dE1lbnVJZCA9IFwiZnVnYVwiO1xuXG4vKipcbiAqL1xuZXhwb3J0IGRlZmF1bHQgY2xhc3MgQ3Vyc29yZWRUb1NsYWNrIHtcbiAgLyoqXG4gICAqIFJlcHJlc2VudHMgYSBDdXJzb3JlZFRvU2xhY2tcbiAgICogQGNvbnN0cnVjdG9yXG4gICAqIEBwYXJhbSB7b2JqZWN0fSBjaHJvbWUgQVBJXG4gICAqL1xuICBjb25zdHJ1Y3RvcihjaHJvbWUpIHtcbiAgICB0aGlzLmNocm9tZSA9IGNocm9tZTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgcGVyc2lzdGVuY2Ugb3B0aW9ucy5cbiAgICogQHJldHVybiB7UHJvbWlzZX0gb3B0aW9ucyByZXR1cm5lZCBpZiBpdCByZXNvbHZlZC5cbiAgICovXG4gIGFzeW5jIGdldE9wdGlvbnMoKSB7XG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiB7XG4gICAgICB0aGlzLmNocm9tZS5zdG9yYWdlLnN5bmMuZ2V0KFtPcHRpb25zS2V5XSwgKHJlc3VsdCkgPT4ge1xuICAgICAgICBjb25zdCB2YWx1ZSA9IG5ldyBDdXJzb3JlZFRvU2xhY2tPcHRpb24ocmVzdWx0W09wdGlvbnNLZXldKTtcbiAgICAgICAgcmVzb2x2ZSh2YWx1ZSk7XG4gICAgICB9KTtcbiAgICB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBTZXQgcGVyc2lzdGVuY2Ugb3B0aW9ucy5cbiAgICogQHBhcmFtIHtvYmplY3R9IG9iamVjdCBoYXMgcGVyc2lzdGVuY2Ugb3B0aW9ucy5cbiAgICogQHJldHVybiB7UHJvbWlzZX0gcmV0dXJucyBib29sIGlmIGl0IHJlc29sdmVkLlxuICAgKi9cbiAgYXN5bmMgc2V0T3B0aW9ucyh2YWx1ZSkge1xuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICBpZiAodmFsdWUgaW5zdGFuY2VvZiBDdXJzb3JlZFRvU2xhY2tPcHRpb24gPT09IGZhbHNlKSB7XG4gICAgICAgIHJlamVjdChcIndyb25nIGluc3RhbmNlb2ZcIik7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIHRoaXMuY2hyb21lLnN0b3JhZ2Uuc3luYy5zZXQoeyBbT3B0aW9uc0tleV06IHZhbHVlIH0sICgpID0+IHtcbiAgICAgICAgcmVzb2x2ZSh0cnVlKTtcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIGNvbnRleHRNZW51cy5vbkNsaWNrZWQgY2FsbGJhY2suXG4gICAqXG4gICAqIHRoaXMgaXMgdXNlZCBieSBhZGRDb250ZXh0TWVudSgpIGZ1bmN0aW9uLlxuICAgKiBAc2VlIHtAbGluayBodHRwczovL2RldmVsb3Blci5jaHJvbWUuY29tL2V4dGVuc2lvbnMvY29udGV4dE1lbnVzI2V2ZW50LW9uQ2xpY2tlZH1cbiAgICovXG4gIGFzeW5jIGNvbnRleHRNZW51T25DbGlja2VkQ2FsbGJhY2soaW5mbykge1xuICAgIGNvbnN0IGlzTXlFdmVudCA9IENvbnRleHRNZW51SWQgPT09IGluZm8ubWVudUl0ZW1JZDtcbiAgICBpZiAoIWlzTXlFdmVudCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGxldCBtZXNzYWdlID0gXCJcIjtcbiAgICBjb25zdCBvcmRlckxpc3QgPSBbXG4gICAgICBcInNlbGVjdGlvblRleHRcIixcbiAgICAgIFwibGlua1VybFwiLFxuICAgICAgXCJzcmNVcmxcIixcbiAgICAgIFwicGFnZVVybFwiLFxuICAgICAgXCJmcmFtZVVybFwiLFxuICAgIF07XG4gICAgZm9yIChjb25zdCBvcmRlciBvZiBvcmRlckxpc3QpIHtcbiAgICAgIGlmIChpbmZvW29yZGVyXSkge1xuICAgICAgICBtZXNzYWdlID0gaW5mb1tvcmRlcl07XG4gICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgIH1cbiAgICBpZiAoIW1lc3NhZ2UpIHtcbiAgICAgIGNvbnNvbGUubG9nKCdubyBjb250ZW50cycpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGNvbnN0IG9wdGlvbnMgPSBhd2FpdCB0aGlzLmdldE9wdGlvbnMoKTtcbiAgICB0aGlzLnNlbmRSZXF1ZXN0VG9TbGFja0FwaShtZXNzYWdlLCBvcHRpb25zLndlYmhvb2tVcmwpO1xuICB9XG5cbiAgLyoqXG4gICAqIEFkZCBjb250ZXh0IG1lbnUuXG4gICAqL1xuICBhZGRDb250ZXh0TWVudSgpIHtcbiAgICAvLyBhZGQgb25DbGlja2VkIGNhbGxiYWNrLlxuICAgIHRoaXMuY2hyb21lLmNvbnRleHRNZW51cy5vbkNsaWNrZWQuYWRkTGlzdGVuZXIoXG4gICAgICB0aGlzLmNvbnRleHRNZW51T25DbGlja2VkQ2FsbGJhY2suYmluZCh0aGlzKVxuICAgICk7XG5cbiAgICAvLyBjb25zdCBjb250ZXh0cyA9IFtcInBhZ2VcIiwgXCJzZWxlY3Rpb25cIiwgXCJsaW5rXCIsIFwiZWRpdGFibGVcIiwgXCJpbWFnZVwiLCBcInZpZGVvXCIsIFwiYXVkaW9cIl07XG4gICAgY29uc3QgY29udGV4dHMgPSBbXCJhbGxcIl07XG4gICAgdGhpcy5jaHJvbWUuY29udGV4dE1lbnVzLmNyZWF0ZSh7XG4gICAgICBpZDogQ29udGV4dE1lbnVJZCxcbiAgICAgIHR5cGU6IFwibm9ybWFsXCIsXG4gICAgICB0aXRsZTogXCJTZW5kIHRvIFNsYWNrXCIsXG4gICAgICBjb250ZXh0czogY29udGV4dHMsXG4gICAgICB2aXNpYmxlOiB0cnVlLFxuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIFNlbmQgcmVxdWVzdCB0byBTbGFjayBBUEkuXG4gICAqIEBwYXJhbSB7c3RyaW5nfSB0ZXh0IFByb3BlcnRpZXMgb2YgcG9zdCBib2R5LlxuICAgKiBAcGFyYW0ge3N0cmluZ30gd2ViaG9va1VybCBTbGFja1dlYmhvb2tVcmxcbiAgICovXG4gIGFzeW5jIHNlbmRSZXF1ZXN0VG9TbGFja0FwaSh0ZXh0LCB3ZWJob29rVXJsKSB7XG4gICAgLy8gYnVpbGQgZGF0YVxuICAgIGNvbnN0IGJvZHkgPSB7IHRleHQ6IHRleHQgfTtcblxuICAgIHJldHVybiBhd2FpdCBmZXRjaCh3ZWJob29rVXJsLCB7XG4gICAgICBtZXRob2Q6IFwiUE9TVFwiLFxuICAgICAgY2FjaGU6IFwibm8tY2FjaGVcIixcbiAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgLy8gTk9URTogU2xhY2sgV2ViaG9vayBkb2VzIG5vdCBzdXBwb3J0IHByZWZsaWdodC5cbiAgICAgICAgLy8gaHR0cHM6Ly9hcGkuc2xhY2suY29tL3dlYlxuICAgICAgICBcIkNvbnRlbnQtVHlwZVwiOiBcImFwcGxpY2F0aW9uL3gtd3d3LWZvcm0tdXJsZW5jb2RlZFwiLFxuICAgICAgfSxcbiAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KGJvZHkpLFxuICAgIH0pXG4gICAgICAudGhlbigocmVzKSA9PiByZXMudGV4dCgpKVxuICAgICAgLnRoZW4oKGJvZHkpID0+IGJvZHkpO1xuICB9XG59XG4iLCJpbXBvcnQgQ3Vyc29yZWRUb1NsYWNrIGZyb20gXCIuL2N1cnNvcmVkdG9zbGFja1wiO1xuaW1wb3J0IHtcbiAgU2xhY2tXZWJob29rQ29tbW9uSG9zdFBhdGgsXG4gIEN1cnNvcmVkVG9TbGFja09wdGlvbixcbn0gZnJvbSBcIi4vY3Vyc29yZWR0b3NsYWNrLW9wdGlvblwiO1xuXG5leHBvcnQgY29uc3QgQ29uc3QgPSB7XG4gIGRvbUlkOiB7XG4gICAgZm9ybTogXCJvcHRpb25Gb3JtXCIsXG4gICAgd2ViaG9va1BhdGg6IFwic2xhY2tXZWJob29rUGF0aElucHV0XCIsXG4gICAgdGVzdEJ1dHRvbjogXCJ0ZXN0QnV0dG9uXCIsXG4gICAgc2F2ZUJ1dHRvbjogXCJzYXZlQnV0dG9uXCIsXG4gICAgdGVzdEJ1dHRvbkxhYmVsOiBcInRlc3RCdXR0b25MYWJlbFwiLFxuICAgIHNhdmVCdXR0b25MYWJlbDogXCJzYXZlQnV0dG9uTGFiZWxcIixcbiAgICB3ZWJob29rRmVlZGJhY2s6IFwic2xhY2tXZWJob29rUGF0aEludmFsaWRGZWVkYmFja1wiLFxuICAgIHdlYmhvb2tNYXNrQnV0dG9uOiBcInRvZ2dsZVdlYmhvb2tQYXRoTWFza0J1dHRvblwiLFxuICAgIHdlYmhvb2tJY29uTWFzazogXCJ0b2dnbGVXZWJob29rUGF0aE1hc2tCdXR0b25NYXNrXCIsXG4gICAgd2ViaG9va0ljb25Vbk1hc2s6IFwidG9nZ2xlV2ViaG9va1BhdGhNYXNrQnV0dG9uVW5NYXNrXCIsXG4gICAgYWxlcnQ6IFwiYWxlcnRNZXNzYWdlXCIsXG4gICAgYWxlcnRUZW1wbGF0ZTogXCJhbGVydE1lc3NhZ2VUZW1wbGF0ZVwiLFxuICB9LFxuICBsYWJlbDoge1xuICAgIHNhdmU6IFwiU2F2ZVwiLFxuICAgIHNhdmluZzogXCJTYXZpbmcuLi5cIixcbiAgICBzYXZlU3VjY2VzczogXCJTYXZlZC5cIixcbiAgICB0ZXN0OiBcIlRlc3RcIixcbiAgICB0ZXN0aW5nOiBcIlNlbmRpbmcuLi5cIixcbiAgICB0ZXN0U3VjY2VzczogXCJTZW50LlwiLFxuICAgIHRlc3RTdWNjZXNzQWRkaXRpb246IFwiQ2hlY2sgU2xhY2sgY2hhbm5lbC5cIixcbiAgICB0ZXN0RmFpbGVkOiBcIkZhaWxlZCB0byBzZW5kIGEgdGVzdCBtZXNzYWdlLlwiLFxuICB9LFxuICB1aVN0YXRlQ2hhbmdlSW50ZXJ2YWxJblNlYzogMSxcbn07XG5cbi8qKlxuICogR2V0IGZvcm0gdmFsdWVzLlxuICogQHJldHVybnMgQ3Vyc29yZWRUb1NsYWNrT3B0aW9uXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBnZXRPcHRpb25Gcm9tRm9ybSgpIHtcbiAgY29uc3Qgd2ViaG9va1BhdGhJbnB1dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKENvbnN0LmRvbUlkLndlYmhvb2tQYXRoKTtcblxuICBjb25zdCBvcHRpb24gPSBuZXcgQ3Vyc29yZWRUb1NsYWNrT3B0aW9uKCk7XG4gIG9wdGlvbi53ZWJob29rUGF0aCA9IHdlYmhvb2tQYXRoSW5wdXQudmFsdWU7XG5cbiAgcmV0dXJuIG9wdGlvbjtcbn1cblxuLyoqXG4gKiBWYWxpZGF0ZSBGb3JtLCB1cGRhdGUgVUkgc3RhdGUuXG4gKiBAcmV0dXJucyB7Ym9vbGVhbn0gUmV0dXJucyB0cnVlIGlmIHZhbGlkLCBmYWxzZSBvdGhlcndpc2UuXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiB2YWxpZGF0ZUZvcm0oKSB7XG4gIGNvbnN0IHZhbGlkVXJsID0gdmFsaWRhdGVTbGFja3dlYmhvb2tQYXRoKCk7XG4gIHZhbGlkYXRlQnV0dG9ucygpO1xuICByZXR1cm4gdmFsaWRVcmw7XG59XG5cbi8qKlxuICogUmVtb3ZlIGhvc3QgYW5kIGNvbW1vbiBwYXRoIGZyb20gVVJMLlxuICogQHBhcmFtcyB7c3RyaW5nfSB2YWx1ZS5cbiAqIEByZXR1cm5zIHtzdHJpbmd9IFJldHVybnMgUmVtb3ZlZCBVUkwuXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiByZW1vdmVTbGFja0hvc3RQYXRoRnJvbVNsYWNrd2ViaG9va1BhdGgoKSB7XG4gIGNvbnN0IGlucHV0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoQ29uc3QuZG9tSWQud2ViaG9va1BhdGgpO1xuICBjb25zdCByZXBsYWNlZCA9IGlucHV0LnZhbHVlLnJlcGxhY2UoU2xhY2tXZWJob29rQ29tbW9uSG9zdFBhdGgsIFwiXCIpO1xuICBpZiAocmVwbGFjZWQpIHtcbiAgICBpbnB1dC52YWx1ZSA9IHJlcGxhY2VkO1xuICB9XG59XG5cbi8qKlxuICogVmFsaWRhdGUgd2ViaG9vayB1cmwsIGFuZCB1cGRhdGUgVUkgc3RhdGUuXG4gKiBAcmV0dXJucyB7Ym9vbGVhbn0gUmV0dXJucyB0cnVlIGlmIHZhbGlkLCBmYWxzZSBvdGhlcndpc2UuXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiB2YWxpZGF0ZVNsYWNrd2ViaG9va1BhdGgoKSB7XG4gIGNvbnN0IG9wdGlvbiA9IGdldE9wdGlvbkZyb21Gb3JtKCk7XG4gIGNvbnN0IGVycm9ycyA9IG9wdGlvbi52YWxpZGF0ZSgpO1xuICBjb25zdCBpbnB1dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKENvbnN0LmRvbUlkLndlYmhvb2tQYXRoKTtcbiAgaWYgKGVycm9yc1tcIndlYmhvb2tQYXRoXCJdKSB7XG4gICAgaW5wdXQuY2xhc3NMaXN0LmFkZChcImlzLWludmFsaWRcIik7XG4gIH0gZWxzZSB7XG4gICAgaW5wdXQuY2xhc3NMaXN0LnJlbW92ZShcImlzLWludmFsaWRcIik7XG4gIH1cblxuICBpZiAoZXJyb3JzW1wid2ViaG9va1BhdGhcIl0pIHtcbiAgICBjb25zdCBmZWVkQmFjayA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKENvbnN0LmRvbUlkLndlYmhvb2tGZWVkYmFjayk7XG4gICAgZmVlZEJhY2sudGV4dENvbnRlbnQgPSBlcnJvcnNbXCJ3ZWJob29rUGF0aFwiXTtcbiAgfVxuXG4gIHJldHVybiB0eXBlb2YgZXJyb3JzW1wid2ViaG9va1BhdGhcIl0gPT09IFwidW5kZWZpbmVkXCI7XG59XG5cbi8qKlxuICogVmFsaWRhdGUgQnV0dG9uIFVJcy5cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHZhbGlkYXRlQnV0dG9ucygpIHtcbiAgY29uc3Qgb3B0aW9uID0gZ2V0T3B0aW9uRnJvbUZvcm0oKTtcbiAgY29uc3QgZXJyb3JzID0gb3B0aW9uLnZhbGlkYXRlKCk7XG4gIGNvbnN0IGlzVmFsaWQgPSB0eXBlb2YgZXJyb3JzW1wid2ViaG9va1BhdGhcIl0gPT09IFwidW5kZWZpbmVkXCI7XG5cbiAgc2V0QnV0dG9uVWlTdGF0ZShcbiAgICBDb25zdC5kb21JZC50ZXN0QnV0dG9uLFxuICAgIENvbnN0LmRvbUlkLnRlc3RCdXR0b25MYWJlbHN0LFxuICAgIGlzVmFsaWQgPyAyIDogMSxcbiAgICBcIlwiXG4gICk7XG4gIHNldEJ1dHRvblVpU3RhdGUoXG4gICAgQ29uc3QuZG9tSWQuc2F2ZUJ1dHRvbixcbiAgICBDb25zdC5kb21JZC5zYXZlQnV0dG9uTGFiZWxlLFxuICAgIGlzVmFsaWQgPyAyIDogMSxcbiAgICBcIlwiXG4gICk7XG59XG5cbi8qKlxuICogU2V0IGEgYnV0dG9uIFVJIHNhdGUuXG4gKiBAcGFyYW0ge3N0cmluZ30gYnV0dG9uSWQgVUkgaWQuXG4gKiBAcGFyYW0ge3N0cmluZ30gbGFiZWxJZCBVSSBpZC5cbiAqIEBwYXJhbSB7bnVtYmVyfSBzdGF0ZSAxOmRpc2FibGVkIDI6ZW5hYmxlZCAzOnJ1bm5pbmcgNDplcnJvclxuICogQHBhcmFtIHtzdHJpbmd9IGxhYmVsIEJ1dHRvbiBsYWJlbC5cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHNldEJ1dHRvblVpU3RhdGUoYnV0dG9uSWQsIGxhYmVsSWQsIHN0YXRlLCBsYWJlbCkge1xuICBjb25zdCBidXR0b24gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChidXR0b25JZCk7XG4gIGNvbnN0IGJ1dHRvbkxhYmVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQobGFiZWxJZCk7XG4gIGlmIChidXR0b25MYWJlbCkge1xuICAgIGJ1dHRvbkxhYmVsLnRleHRDb250ZW50ID0gbGFiZWw7XG4gIH1cbiAgaWYgKHN0YXRlID09PSAxKSB7XG4gICAgYnV0dG9uLmNsYXNzTGlzdC5yZW1vdmUoXCJydW5uaW5nXCIpO1xuICAgIGJ1dHRvbi5kaXNhYmxlZCA9IHRydWU7XG4gIH0gZWxzZSBpZiAoc3RhdGUgPT09IDIpIHtcbiAgICBidXR0b24uY2xhc3NMaXN0LnJlbW92ZShcInJ1bm5pbmdcIik7XG4gICAgYnV0dG9uLmRpc2FibGVkID0gZmFsc2U7XG4gIH0gZWxzZSBpZiAoc3RhdGUgPT09IDMpIHtcbiAgICBidXR0b24uY2xhc3NMaXN0LmFkZChcInJ1bm5pbmdcIik7XG4gICAgYnV0dG9uLmRpc2FibGVkID0gZmFsc2U7XG4gIH1cbn1cblxuLyoqXG4gKiBDaGFuZ2UgV2ViaG9vayBVUkwgTWFzayBJY29uIHZpc2libGUgc3RhdGUuXG4gKiBAcGFyYW0ge2Jvb2xlYW59IGlzTWFzayBNYXNrIFVSTCBpZiBpdCdzIHRydWUsIFVubWFzayBvdGhlcndpc2UuXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBtYXNrd2ViaG9va1BhdGhJbnB1dFZhbHVlKGlzTWFzaykge1xuICBjb25zdCBpbnB1dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKENvbnN0LmRvbUlkLndlYmhvb2tQYXRoKTtcbiAgY29uc3QgaWNvbk1hc2sgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChDb25zdC5kb21JZC53ZWJob29rSWNvbk1hc2spO1xuICBjb25zdCBpY29uVW5NYXNrID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoQ29uc3QuZG9tSWQud2ViaG9va0ljb25Vbk1hc2spO1xuICBpZiAoaXNNYXNrKSB7XG4gICAgaW5wdXQuc2V0QXR0cmlidXRlKFwidHlwZVwiLCBcInBhc3N3b3JkXCIpO1xuICAgIGljb25NYXNrLmNsYXNzTGlzdC5yZW1vdmUoXCJkLW5vbmVcIik7XG4gICAgaWNvblVuTWFzay5jbGFzc0xpc3QuYWRkKFwiZC1ub25lXCIpO1xuICB9IGVsc2Uge1xuICAgIGlucHV0LnNldEF0dHJpYnV0ZShcInR5cGVcIiwgXCJ0ZXh0XCIpO1xuICAgIGljb25NYXNrLmNsYXNzTGlzdC5hZGQoXCJkLW5vbmVcIik7XG4gICAgaWNvblVuTWFzay5jbGFzc0xpc3QucmVtb3ZlKFwiZC1ub25lXCIpO1xuICB9XG59XG5cbi8qKlxuICogVG9nZ2xlIFdlYmhvb2sgVVJMIE1hc2sgSWNvbiB2aXNpYmxlIHN0YXRlLlxuICovXG5leHBvcnQgZnVuY3Rpb24gdG9nZ2xld2ViaG9va1BhdGhJbnB1dE1hc2soKSB7XG4gIGNvbnN0IG1hc2tJY29uID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoQ29uc3QuZG9tSWQud2ViaG9va0ljb25NYXNrKTtcbiAgY29uc3QgaXNNYXNrTmV4dCA9IG1hc2tJY29uLmNsYXNzTGlzdC5jb250YWlucyhcImQtbm9uZVwiKTtcbiAgbWFza3dlYmhvb2tQYXRoSW5wdXRWYWx1ZShpc01hc2tOZXh0KTtcbn1cblxuLyoqXG4gKiBTaG93IGFsZXJ0LlxuICogQHBhcmFtIHtib29sZWFufSBpc1Nob3cgU2hvdyB0aGUgYWxlcnQgaWYgaXQncyB0cnVlLCBoaWRlIG90aGVyd2lzZS5cbiAqIEBwYXJhbSB7Ym9vbGVhbn0gaXNFcnJvciBTaG93IHRoZSBkYW5nZXIgYWxlcnQgaWYgaXQncyB0cnVlLCBzdWNjZXNzIG90aGVyd2lzZS5cbiAqIEBwYXJhbSB7c3RyaW5nfSBtZXNzYWdlIEFsZXJ0IG1lc3NhZ2UuXG4gKiBAcGFyYW0ge3N0cmluZ30gYWRkaXRpb25NZXNzYWdlIEFsZXJ0IGFkZGl0aW9uIG1lc3NhZ2UuXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBzaG93QWxlcnRNZXNzYWdlKGlzU2hvdywgaXNFcnJvciwgbWVzc2FnZSwgYWRkaXRpb25NZXNzYWdlKSB7XG4gIGlmIChpc1Nob3cpIHtcbiAgICBjb25zdCB0ZW1wbGF0ZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKENvbnN0LmRvbUlkLmFsZXJ0VGVtcGxhdGUpO1xuICAgIGNvbnN0IGFsZXJ0QmxvY2sgPSB0ZW1wbGF0ZS5jbG9uZU5vZGUodHJ1ZSk7XG4gICAgY29uc3QgYWxlcnQgPSBhbGVydEJsb2NrLmdldEVsZW1lbnRzQnlDbGFzc05hbWUoXCJhbGVydFwiKTtcbiAgICBjb25zdCBhbGVydE1lc3NhZ2UgPSBhbGVydFswXS5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKFwiYWxlcnRNZXNzYWdlXCIpO1xuICAgIGNvbnN0IGFsZXJ0QWRkaXRpb25NZXNzYWdlID0gYWxlcnRbMF0uZ2V0RWxlbWVudHNCeUNsYXNzTmFtZShcbiAgICAgIFwiYWxlcnRBZGRpdGlvbk1lc3NhZ2VcIlxuICAgICk7XG4gICAgYWxlcnRbMF0uaWQgPSBDb25zdC5kb21JZC5hbGVydDtcbiAgICBhbGVydFswXS5jbGFzc0xpc3QuYWRkKGlzRXJyb3IgPyBcImFsZXJ0LWRhbmdlclwiIDogXCJhbGVydC1zdWNjZXNzXCIpO1xuICAgIGFsZXJ0TWVzc2FnZVswXS50ZXh0Q29udGVudCA9IG1lc3NhZ2U7XG4gICAgaWYgKGFkZGl0aW9uTWVzc2FnZSkge1xuICAgICAgYWxlcnRBZGRpdGlvbk1lc3NhZ2VbMF0udGV4dENvbnRlbnQgPSBhZGRpdGlvbk1lc3NhZ2U7XG4gICAgfSBlbHNlIHtcbiAgICAgIGFsZXJ0QWRkaXRpb25NZXNzYWdlWzBdLnJlbW92ZSgpO1xuICAgIH1cbiAgICB0ZW1wbGF0ZS5iZWZvcmUoYWxlcnRbMF0pO1xuICB9IGVsc2Uge1xuICAgIGNvbnN0IGFsZXJ0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoQ29uc3QuZG9tSWQuYWxlcnQpO1xuICAgIGlmIChhbGVydCkge1xuICAgICAgYWxlcnQucmVtb3ZlKCk7XG4gICAgfVxuICB9XG59XG5cbi8qKlxuICogY29uc3RydWN0IG9wdGlvbnMganMuXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBjb25zdHJ1Y3RPcHRpb25zKCkge1xuICBjb25zdCB3ZWJob29rSW5wdXQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChDb25zdC5kb21JZC53ZWJob29rUGF0aCk7XG4gIGlmICh3ZWJob29rSW5wdXQpIHtcbiAgICB3ZWJob29rSW5wdXQuYWRkRXZlbnRMaXN0ZW5lcihcImJsdXJcIiwgKCkgPT4ge1xuICAgICAgcmVtb3ZlU2xhY2tIb3N0UGF0aEZyb21TbGFja3dlYmhvb2tQYXRoKCk7XG4gICAgICB2YWxpZGF0ZVNsYWNrd2ViaG9va1BhdGgoKTtcbiAgICAgIHZhbGlkYXRlQnV0dG9ucygpO1xuICAgIH0pO1xuICB9XG5cbiAgY29uc3QgdGVzdEJ1dHRvbiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKENvbnN0LmRvbUlkLnRlc3RCdXR0b24pO1xuICBpZiAodGVzdEJ1dHRvbikge1xuICAgIHRlc3RCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgICAgIGNvbnN0IGlzVmFsaWQgPSB2YWxpZGF0ZUZvcm0oKTtcbiAgICAgIGlmICghaXNWYWxpZCkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIHNob3dBbGVydE1lc3NhZ2UoZmFsc2UpO1xuXG4gICAgICBzZXRCdXR0b25VaVN0YXRlKFxuICAgICAgICBDb25zdC5kb21JZC50ZXN0QnV0dG9uLFxuICAgICAgICBDb25zdC5kb21JZC50ZXN0QnV0dG9uTGFiZWwsXG4gICAgICAgIDMsXG4gICAgICAgIENvbnN0LmxhYmVsLnRlc3RpbmdcbiAgICAgICk7XG4gICAgICBzZXRUaW1lb3V0KGFzeW5jICgpID0+IHtcbiAgICAgICAgY29uc3QgY3RzID0gbmV3IEN1cnNvcmVkVG9TbGFjayhjaHJvbWUpO1xuICAgICAgICBjb25zdCBvcHRpb24gPSBnZXRPcHRpb25Gcm9tRm9ybSgpO1xuICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBjdHNcbiAgICAgICAgICAuc2VuZFJlcXVlc3RUb1NsYWNrQXBpKFwidGVzdCBtZXNzYWdlLlwiLCBvcHRpb24ud2ViaG9va1VybClcbiAgICAgICAgICAuY2F0Y2goKGVycm9yKSA9PiBlcnJvcik7XG5cbiAgICAgICAgY29uc3QgaXNFcnJvciA9IHJlc3VsdCBpbnN0YW5jZW9mIEVycm9yO1xuICAgICAgICBpZiAoaXNFcnJvcikge1xuICAgICAgICAgIHNob3dBbGVydE1lc3NhZ2UodHJ1ZSwgaXNFcnJvciwgQ29uc3QubGFiZWwudGVzdEZhaWxlZCwgcmVzdWx0LnN0YWNrKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBzaG93QWxlcnRNZXNzYWdlKFxuICAgICAgICAgICAgdHJ1ZSxcbiAgICAgICAgICAgIGlzRXJyb3IsXG4gICAgICAgICAgICBDb25zdC5sYWJlbC50ZXN0U3VjY2VzcyxcbiAgICAgICAgICAgIENvbnN0LmxhYmVsLnRlc3RTdWNjZXNzQWRkaXRpb25cbiAgICAgICAgICApO1xuICAgICAgICB9XG5cbiAgICAgICAgc2V0QnV0dG9uVWlTdGF0ZShcbiAgICAgICAgICBDb25zdC5kb21JZC50ZXN0QnV0dG9uLFxuICAgICAgICAgIENvbnN0LmRvbUlkLnRlc3RCdXR0b25MYWJlbCxcbiAgICAgICAgICAyLFxuICAgICAgICAgIENvbnN0LmxhYmVsLnRlc3RcbiAgICAgICAgKTtcbiAgICAgIH0sIENvbnN0LnVpU3RhdGVDaGFuZ2VJbnRlcnZhbEluU2VjICogMTAwMCk7XG4gICAgfSk7XG4gIH1cblxuICBjb25zdCBmb3JtID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoQ29uc3QuZG9tSWQuZm9ybSk7XG4gIGlmIChmb3JtKSB7XG4gICAgZm9ybS5hZGRFdmVudExpc3RlbmVyKFwic3VibWl0XCIsIChldmVudCkgPT4ge1xuICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuXG4gICAgICBjb25zdCBpc1ZhbGlkID0gdmFsaWRhdGVGb3JtKCk7XG4gICAgICBpZiAoIWlzVmFsaWQpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICBzaG93QWxlcnRNZXNzYWdlKGZhbHNlKTtcblxuICAgICAgc2V0QnV0dG9uVWlTdGF0ZShcbiAgICAgICAgQ29uc3QuZG9tSWQuc2F2ZUJ1dHRvbixcbiAgICAgICAgQ29uc3QuZG9tSWQuc2F2ZUJ1dHRvbkxhYmVsLFxuICAgICAgICAzLFxuICAgICAgICBDb25zdC5sYWJlbC5zYXZpbmdcbiAgICAgICk7XG4gICAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgY29uc3QgY3RzID0gbmV3IEN1cnNvcmVkVG9TbGFjayhjaHJvbWUpO1xuICAgICAgICBjb25zdCBvcHRpb24gPSBnZXRPcHRpb25Gcm9tRm9ybSgpO1xuICAgICAgICBjdHMuc2V0T3B0aW9ucyhvcHRpb24pLnRoZW4oKCkgPT4ge1xuICAgICAgICAgIHNob3dBbGVydE1lc3NhZ2UodHJ1ZSwgZmFsc2UsIENvbnN0LmxhYmVsLnNhdmVTdWNjZXNzKTtcblxuICAgICAgICAgIHNldEJ1dHRvblVpU3RhdGUoXG4gICAgICAgICAgICBDb25zdC5kb21JZC5zYXZlQnV0dG9uLFxuICAgICAgICAgICAgQ29uc3QuZG9tSWQuc2F2ZUJ1dHRvbkxhYmVsLFxuICAgICAgICAgICAgMixcbiAgICAgICAgICAgIENvbnN0LmxhYmVsLnNhdmVcbiAgICAgICAgICApO1xuICAgICAgICB9KTtcbiAgICAgIH0sIENvbnN0LnVpU3RhdGVDaGFuZ2VJbnRlcnZhbEluU2VjICogMTAwMCk7XG4gICAgfSk7XG4gIH1cblxuICBjb25zdCBtYXNrQnV0dG9uID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoQ29uc3QuZG9tSWQud2ViaG9va01hc2tCdXR0b24pO1xuICBpZiAobWFza0J1dHRvbikge1xuICAgIG1hc2tCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgICAgIHRvZ2dsZXdlYmhvb2tQYXRoSW5wdXRNYXNrKCk7XG4gICAgfSk7XG4gIH1cblxuICAvLyBpbml0aWFsaXplLlxuICBjb25zdCBjdHMgPSBuZXcgQ3Vyc29yZWRUb1NsYWNrKGNocm9tZSk7XG4gIGN0cy5nZXRPcHRpb25zKCkudGhlbigob3B0aW9ucykgPT4ge1xuICAgIGNvbnN0IGlzVmFsaWQgPSBPYmplY3Qua2V5cyhvcHRpb25zLnZhbGlkYXRlKCkpLmxlbmd0aCA9PT0gMDtcbiAgICBpZiAoaXNWYWxpZCkge1xuICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoQ29uc3QuZG9tSWQud2ViaG9va1BhdGgpLnZhbHVlID1cbiAgICAgICAgb3B0aW9ucy53ZWJob29rUGF0aDtcbiAgICB9XG4gICAgdmFsaWRhdGVCdXR0b25zKCk7XG5cbiAgICBtYXNrd2ViaG9va1BhdGhJbnB1dFZhbHVlKHRydWUpO1xuICB9KTtcbn1cblxuY29uc3QgaXNDYWxsZWRDaHJvbWUgPVxuICB0eXBlb2YgUlVOTklOR19PTl9DSFJPTUUgIT09IFwidW5kZWZpbmVkXCIgJiYgUlVOTklOR19PTl9DSFJPTUU7XG5pZiAoaXNDYWxsZWRDaHJvbWUpIHtcbiAgY29uc3RydWN0T3B0aW9ucygpO1xufVxuIl0sInNvdXJjZVJvb3QiOiIifQ==